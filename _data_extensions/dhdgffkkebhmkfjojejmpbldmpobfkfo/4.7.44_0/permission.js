Registry.require(["promise","helper","asker"],function(){var e=Registry.get("promise"),l=Registry.get("helper"),k=Registry.get("asker"),c=!1,d=null,f=function(){var a=e(),b=function(){c?window.setTimeout(b,50):a.resolve()};b();return a.promise()},h={permContentSettings:"contentSettings",permDownloads:"downloads",clear:function(){c&&console.log("perm: clear, but locked");d=null},get:function(){var a=e();d={};c=!0;rea.permissions.getAll(function(b){l.each(b.permissions,function(a,b){d[a]=!0});c=!1;
a.resolve()});return a.promise()},has:function(a){return f().then(function(){return d?!!d[a]:h.get().then(function(){return h.has(a)})})},hasOrigin:function(a){Array.isArray(a)||(a=[a]);return f().then(function(){var b=e();rea.permissions.contains({origins:a},function(a){b.resolve(a)});return b.promise()})},ask:function(a,b,c){Array.isArray(a)||(a=[a]);var g=e();rea.permissions.supported?k.askForPermission({permissions:a},b,c).done(function(b){b.granted&&(d||(d={}),d[a]=!0);g.resolve(b.granted)}):
g.resolve(!1);return g.promise()},askOrigin:function(a,b,d){Array.isArray(a)||(a=[a]);var c=e();rea.permissions.supported?k.askForPermission({origins:a},b,d).done(function(a){c.resolve(a.granted)}):c.resolve(!1);return c.promise()},remove:function(a){return f().then(function(){var b=e();rea.permissions.supported?(c=!0,rea.permissions.remove({permissions:[a]},function(e){c=!1;d&&(d[a]=!1);b.resolve(e)})):b.resolve(!0);return b.promise()})},addListener:function(a){rea.permissions.onAdded.addListener(function(b){a({added:b})});
rea.permissions.onRemoved.addListener(function(b){a({removed:b})})}};Registry.register("permission","5873",h)});
